<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      color: #333;
    }
    h2 {
      margin-bottom: 4px;
    }
    p.subtitle {
      color: #888;
      margin-top: 0;
      margin-bottom: 24px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }
    input[type="text"]:focus {
      outline: none;
      border-color: #c00d0d;
    }
    .hint {
      font-size: 12px;
      color: #888;
      margin-top: -12px;
      margin-bottom: 16px;
    }
    button {
      width: 100%;
      padding: 12px;
      background: #c00d0d !important;
      color: white !important;
      border: none !important;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #a00b0b !important;
    }
    button:disabled {
      background: #c00d0d !important;
      opacity: 0.5;
      cursor: not-allowed;
    }
    .error {
      color: #d32f2f;
      margin-top: 12px;
      display: none;
    }
  </style>
</head>
<body>
  <h2 data-i18n="pair.ip_address.title">Enter Device Details</h2>
  <p class="subtitle">Connect to your Genvex ventilation unit</p>

  <label for="ip">IP Address</label>
  <input type="text" id="ip" placeholder="192.168.1.100" />

  <label for="email">Email (from Genvex app)</label>
  <input type="text" id="email" placeholder="user@example.com" />
  <div class="hint">Case-sensitive, must match the email registered in the Genvex/Nilan app</div>

  <button id="btn-connect" disabled>Connect</button>
  <div class="error" id="error"></div>

  <script>
    var ipInput = document.getElementById('ip');
    var emailInput = document.getElementById('email');
    var btnConnect = document.getElementById('btn-connect');
    var errorDiv = document.getElementById('error');

    function validate() {
      btnConnect.disabled = !(ipInput.value.trim() && emailInput.value.trim());
    }

    ipInput.addEventListener('input', validate);
    emailInput.addEventListener('input', validate);

    btnConnect.addEventListener('click', function () {
      btnConnect.disabled = true;
      btnConnect.textContent = 'Connecting...';
      errorDiv.style.display = 'none';

      Homey.emit('validate', {
        ip: ipInput.value.trim(),
        email: emailInput.value.trim()
      }, function (err, result) {
        if (err) {
          errorDiv.textContent = err.message || String(err);
          errorDiv.style.display = 'block';
          btnConnect.disabled = false;
          btnConnect.textContent = 'Connect';
        } else {
          Homey.nextView();
        }
      });
    });
  </script>
</body>
</html>
